---
title: "Week 7 - Error-based / Blind SQL Injection"
date: 2025-06-03
categories: [study]
layout: single
author_profile: true
sidebar:
  nav: "main"
read_time: true
toc: true
toc_label: "On this page"
toc_sticky: true
---

## 1. Types of SQL Injection (Union-based, Error-based, Blind)

SQL Injection techniques can generally be categorized into the following three types:

**Union-based SQL Injection**

**Error-based SQL Injection**

**Blind SQL Injection**

### (1) Union-based SQL Injection
Condition: The result of the SQL query is directly displayed on the page.
purpose: Use **UNION SELECT** to append custom queries and extract data by injecting into the output.

``` 
UNION SELECT 1,2,3,4 #
```

→ it is important to match the number of columns 
→ You can insert values into visible columns to leak data

### (2) Error-based SQL Injection

Condition: The server displays detailed SQL error messages.
Goal: Trigger an error that includes the result of a **SELECT** query within the error message itself.

Syntax errors are usually not helpful
Logic errors are more effective for exposing data in the error

Recommended function: __extractvalue()__

``` 
extractvalue('1', concat(0x3a, (select 'normaltic')))
``` 
Attack Format:

``` 
' AND extractvalue('1', concat(0x3a, (SQL))) AND '1'='1
``` 
Typical Steps:

Get the database name
→ SELECT database()

Get table names
→ SELECT table_name FROM information_schema.tables WHERE table_schema='segfault_sql' LIMIT 0,1

Get column names
→ SELECT column_name FROM information_schema.columns WHERE table_name='game' LIMIT 0,1

### (3) Blind SQL Injection

Condition: No data is printed, and no error messages are shown (the response differs only by true/false conditions).

Goal: Extract data by asking true/false questions and observing changes in the server's response.

Basic Format:

``` 
' AND (condition) AND '1'='1
```

Example:

``` 
' AND substr((select 'test'), 1,1) = 't' AND '1'='1
```

Useful Functions:
- substr(string, position, length) → Extract part of a string
- ascii(char) → Get ASCII code of a character
- SELECT database() → Get current database name

## 2. Error Based Injection 
Error based 인젝션을 사용하기위해서는 우선 로직 에러를 발생시켜야한다

로직에러와 문법에러가 무엇이 다른지 우선 살펴보자

문법 에러
: 문법 규칙 자체를 위반 함으로써 발생한다. 예를 들어 **select * from games where name = '$over**
와 같이 ' 를 누락했기때문에 sql문이 실행이 되지 않는다.
![image](https://github.com/user-attachments/assets/f9baa0b9-ed34-4a93-9807-da3a30000905)

로직 에러
: 문법적으로는 문제가 없음에도 불구하고, 알고리즘 / 논리적인 해석의 오류가 발생하여 생기는 오류이다. **SELECT * FROM users WHERE username = '$user' OR 1=1;** 이 쿼리의 의도는 특정 유저만 조회하려는 거지만 or 1=1 d은 항상 true이기에 모든 유저를 출력한다.

union sql injection과 같이 error based injection도 7가지 단계를 따라서 데이터를 추출할 수 있다.


![image](https://github.com/user-attachments/assets/de405a18-815a-4e39-9cbd-e5a321a39509)
step 1. sql 인젝션 포인트 찾기
>> 내가 입력한 싱글쿼터가 sql 쿼리 안으로 들어간것을 확인할 수 있다
 
step 2. 에러를 출력할 수 있는 함수를 선택한다
>> 이번에는 extractvalue(xml,xpath-expr) 함수를 사용한다
extractvalue() 함수
- 첫 번째 인자: XML 형태의 문자열
- 두 번째 인자: XPath (XML 안에서 뭘 꺼낼지 알려주는 경로 표현식

예시로 아래와 같은 XML이 있다고 가정하자
``` 
<user>
  <name>Jimin</name>
</user>
``` 
그럼 extractvalue(xml_string, '/user/name') → "Jimin"을 뽑아줘

하지만 우리는 이 함수를 정상적으로 쓰지않고 에러를 만들기 위해 사용할것이다.
어떤 웹사이트는 SQL 에러가 화면에 그대로 출력되고 그걸 이용해서 우리가 뽑고싶은 데이터를 에레 메세지안에 넣는것이다.

어떻게 에러를 만들것인가?
-> 두 번째 인자인 xpath_expr에 정상적인 XPath 경로 대신 이상한 값을 넣어서 에러를 발생시킨다.

``` 
extractvalue('1', ':abc')
``` 
이때 :abc는 XPath문법에 맞지않는다 따라서 **XPATH syntax error: ':abc'** 와 같은 에러가 발생한다.
이 때 "abc"자리에 우리가 원하는 값을 넣으면 그 값이 에러 메세지로 노출될것이다.

step 3. 공격 format 만들기

"abc"자리에 우리가 원하는 값을 가져오기 위해서는 select문을 넣어줘야할것이다 select문을 넣으면 공격문은 
normaltic' and extractvalue('1', (SELECT '여기에 데이터 뽑기 쿼리 넣기'))) AND '1'='1
이렇게 생각할 수 있다. 하지만 저렇게 select문을 집어넣으면 xpath에 오류가 발생하지않는다 위처럼 ':을 삽입시켜 xpath에 오류를 발생시켜야한다
normaltic' and extractvalue('1', :(SELECT '여기에 데이터 뽑기 쿼리 넣기'))) AND '1'='1
하지만 위처럼 단순히 : 를 삽입하는것은 sql 문법 자체가 잘못된것이기떄문에 쿼리 자체가 실행이 되지 않는다. 즉 에러 메세지에 아무것도 뜨지 않게 된다.
때문에 **concat()**을 이용해 문자열 결합 후 XPath로 넘긴다면 파싱 에러를 발생시킬 수 있다.

``` 
최종 공격 구문:
normaltic' and extractvalue('1', concat(0x3a, (select 'test'))) and '1'='1
normaltic' and extractvalue('1', concat(0x3a, (select '_______'))) and '1'='1
``` 
![image](https://github.com/user-attachments/assets/25b10693-e16c-4f79-b697-8ac89e013d5f)

